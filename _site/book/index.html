<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Comp. Soc. Sci. for Sustainability (EBS 181/281) - Computational Social Science for Sustainability</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Comp. Soc. Sci. for Sustainability (EBS 181/281)</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../book/index.html" aria-current="page"> 
<span class="menu-text">Course Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../lectures/index.qmd"> 
<span class="menu-text">Lectures</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#social-networks" id="toc-social-networks" class="nav-link" data-scroll-target="#social-networks">Social networks</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  </ul></li>
  <li><a href="#developing-models-of-social-behavior-for-sustainability" id="toc-developing-models-of-social-behavior-for-sustainability" class="nav-link" data-scroll-target="#developing-models-of-social-behavior-for-sustainability">Developing models of social behavior for sustainability</a></li>
  </ul></li>
  <li><a href="#diffusion-of-adaptations" id="toc-diffusion-of-adaptations" class="nav-link" data-scroll-target="#diffusion-of-adaptations">Diffusion of adaptations</a>
  <ul class="collapse">
  <li><a href="#la-and-lal-compartmental-contagion-models" id="toc-la-and-lal-compartmental-contagion-models" class="nav-link" data-scroll-target="#la-and-lal-compartmental-contagion-models">LA and LAL compartmental “contagion” models</a>
  <ul class="collapse">
  <li><a href="#legacy-adaptive-la-model" id="toc-legacy-adaptive-la-model" class="nav-link" data-scroll-target="#legacy-adaptive-la-model">Legacy-Adaptive (LA) model</a></li>
  <li><a href="#legacy-adaptive-legacy-lal-model" id="toc-legacy-adaptive-legacy-lal-model" class="nav-link" data-scroll-target="#legacy-adaptive-legacy-lal-model">Legacy-Adaptive-Legacy (LAL) model</a></li>
  </ul></li>
  <li><a href="#adaptive-social-learning" id="toc-adaptive-social-learning" class="nav-link" data-scroll-target="#adaptive-social-learning">Adaptive social learning</a>
  <ul class="collapse">
  <li><a href="#conformity-biased-learning" id="toc-conformity-biased-learning" class="nav-link" data-scroll-target="#conformity-biased-learning">Conformity-biased learning</a></li>
  <li><a href="#success-biased-learning" id="toc-success-biased-learning" class="nav-link" data-scroll-target="#success-biased-learning">Success-biased learning</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#cooperation-and-coordination" id="toc-cooperation-and-coordination" class="nav-link" data-scroll-target="#cooperation-and-coordination">Cooperation and coordination</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Computational Social Science for Sustainability</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Sustainability will only be achieved if people and institutions behave sustainably. This course teaches techniques for predicting the spread of sustainable behaviors, in human social networks. There has been scant real progress towards limiting biodiversity loss, inequality, global warming, and other sustainability targets such as the <a href="https://sdgs.un.org/goals">UN Sustainable Development Goals</a>. This suggests people, institutions, or organizations continue to behave unsustainably, and begs the question: what will it take to get sustainable behaviors to become widely practiced in different societies? Behaviors are transmitted from person to person through social learning, be it through instruction or observation. Who learns from or observes whom is structured based on who we know, who we live near, who we work with, or whose messages we read on the internet.</p>
<section id="social-networks" class="level2">
<h2 class="anchored" data-anchor-id="social-networks">Social networks</h2>
<p>We need to know some basic things about social networks because all models make assumptions about them. First, a social network is a theoretical tool, a “cognitive gadget” , that represents relationships between people. Social networks are instances of graphs, an abstract mathematical structure for representing any type of entities and relationships between them. Graph <em>nodes</em> (aka <em>vertices</em>) represent the entities and <em>edges</em> represent the relationships between nodes. Edges are drawn as lines with or without arrows to indicate the flow of information, with information flowing to a <em>learner</em>, or <em>observer</em> more generally, from a <em>teacher</em> or <em>demonstrator</em> (Figure <a href="#fig-teacher-learner-infoflow" class="quarto-xref">Figure&nbsp;1</a>). Lines with arrows are called <em>directed</em> edges. For a given pair of individuals, each may sometimes be teacher or learner. This case may be represented by two directed edges pointing opposite directions or a single <em>undirected</em> edge, i.e., a line with no arrowheads (Figure <a href="#fig-teacher-learner-bidirectional" class="quarto-xref">Figure&nbsp;2</a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-teacher-learner-infoflow" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-teacher-learner-infoflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-teacher-learner-infoflow-1.png" class="img-fluid figure-img" width="494">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-teacher-learner-infoflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Social networks represent relationships between people, with the arrow pointing away from the teacher and at the learner, i.e., in the direction of information flow.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In social networks, the entities are people and the relationships could be friendships, business partnerships, or, in the case of our first social network example, marriages between powerful families in Florence during the 1400s that elevated the the Medici clan developing into what was essentially one of the world’s first political parties. This follows Jackson’s introductory example in his textbook starting on p.&nbsp;4 <span class="citation" data-cites="Jackson2008">(<a href="#ref-Jackson2008" role="doc-biblioref">Jackson 2008</a>)</span>. Studying the Medici’s social network gives us our first look at the structure of social influence. During that period, the Medici family rose in wealth and political power over the lifetime of the family patriarch, Cosimo. Starting from a relatively weak position overall in the Florentine oligarchy of the time, Cosimo arranged marriages with other powerful families to subtly amplify the Medici control of politics and markets in Florence (Figure <a href="#fig-florentine-network" class="quarto-xref">Figure&nbsp;3</a>; source: <a href="https://cran.r-project.org/web/packages/netrankr/vignettes/use_case.html" class="uri">https://cran.r-project.org/web/packages/netrankr/vignettes/use_case.html</a>). Eventually we will explain Cosimo’s strategy, which is not just simply to have the greatest diversity of intermarriages in the group of oligarchs (though the Medicis did). For now, we will introduce important network concepts and measures using the Medici network for a real-world case study.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="494"></p>
</figure>
</div>
</div>
</div>
<div style="text-align:center; font-weight:bold; font-size:20px">
<p><span class="math inline">\(\uparrow\quad\)</span> is equivalent to <span class="math inline">\(\quad\downarrow\)</span></p>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-teacher-learner-bidirectional" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-teacher-learner-bidirectional-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-teacher-learner-bidirectional-1.png" class="img-fluid figure-img" width="494">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-teacher-learner-bidirectional-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: If there are two arrows, one pointing at each individual, or a line with no arrowheads, then each member of the dyad may be either teacher or learner.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In the Florentine network, the edges are undirected, which makes sense since marriage takes two families and is therefore not directed. Note then we have no knowledge from which family came husband and wife. Note too that there could be multiple marriages between two families, but this information is not contained in this graph.</p>
<p>In an undirected graph, the neighborhood of an individual <span class="math inline">\(i\)</span> (or family, organization, institution, or other social entity) can be written <span class="math inline">\(n_i\)</span> and is a set of all the individuals who share an edge with <span class="math inline">\(i\)</span>. The set of the Medici’s network neighbors then is written mathematically as</p>
<p><span class="math display">\[
n_{\text{Medici}} = \{\text{Salviati},~\text{Acciaiuol},~\text{Barbadori},~\text{Ridolfi},~\text{Tornabuon},~\text{Albizzi}\}
\]</span> The degree of node <span class="math inline">\(i\)</span> is the number of neighbors it has, written <span class="math inline">\(k_i\)</span>, so <span class="math inline">\(k_\text{Medici} = 6\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"florentine_m"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete Pucci family (isolated)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>florentine_m <span class="ot">&lt;-</span> <span class="fu">delete_vertices</span>(florentine_m, <span class="fu">which</span>(<span class="fu">degree</span>(florentine_m) <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the graph</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(florentine_m,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">vertex.label.cex =</span> .<span class="dv">9</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">vertex.size =</span> <span class="dv">20</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">vertex.label.color =</span> <span class="st">"black"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">vertex.color =</span> <span class="st">"white"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">vertex.frame.color =</span> <span class="st">"gray"</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-florentine-network" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-florentine-network-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-florentine-network-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-florentine-network-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Florentine marriage network where edges represent marriages between families (node labels).
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can make a bar plot of the degrees for each family:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <em>degree distribution</em> is the fraction of nodes having degree <span class="math inline">\(k\)</span>, written <span class="math inline">\(P(k)\)</span>. Since the Medici family is the only one with a degree of six, and there are fifteen families, <span class="math inline">\(P(6)=\frac{1}{15}\approx 0.066\)</span>, which we can check like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>degdist <span class="ot">&lt;-</span> <span class="fu">degree_distribution</span>(florentine_m)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>medici_k <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Degree distribution starts at 0 and goes to maximum k; index 1, then</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># correlates to k=0 and need to add 1 to the Medici index.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>degdist[[medici_k <span class="sc">+</span> <span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06666667</code></pre>
</div>
</div>
<p>We can plot a simple histogram representation of <span class="math inline">\(P(k)\)</span> using base R like so</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="at">names=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">height=</span><span class="fu">as.vector</span>(degdist), <span class="at">ylab=</span><span class="st">"Frequency"</span>, <span class="at">xlab=</span><span class="st">"Degree, k"</span>, <span class="at">col=</span><span class="st">"#69b3a2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
</section>
</section>
<section id="developing-models-of-social-behavior-for-sustainability" class="level2">
<h2 class="anchored" data-anchor-id="developing-models-of-social-behavior-for-sustainability">Developing models of social behavior for sustainability</h2>
<p>These models share a general structure:</p>
<ol type="1">
<li>Create a population represented as <span class="math inline">\(N\)</span> nodes in a social network.</li>
<li>At each time step, imagine that each individual in a population “selects” or is otherwise paired with another individual, their <em>interaction partner</em>. Each individual may also take independent action. For example, the Legacy-Adaptive model of the diffusion of adaptations in the next section specifies that when one person doing a Legacy behavior observes another doing the Adaptive behavior, the one doing Legacy will switch to Adaptive with probability <span class="math inline">\(\alpha\)</span>. Over the duration of the course, we will consider interactions that consist of learning/adopting behaviors, deciding whether to cooperate with others for collective adaptation, and influencing opinions.</li>
<li>This process is repeated over many time steps where each individual does something or interacts with another individual.</li>
<li>The conditions for stopping the model, the <em>stopping conditions</em>, must be specified. The simplest stopping condition is to run a simulation for a certain number of time steps. Other options include stopping when the population reaches some form of equilibrium, for example, the number of people doing an adaptive behavior stays relatively constant over several time steps.</li>
<li>We observe how certain <em>outcome variables</em> of interest, such as how many people adopt some behavior over time or how long it takes for some fraction of people to adopt an adaptive behavior.</li>
<li>In full analyses of these models, we analyze these outcome variables across different hypothetical contexts, such as changing how “viral” (i.e.&nbsp;how likely to be adopted) adaptive behaviors are.</li>
</ol>
<p>Developing new models of social behavior amounts to specifying new ways of how people interact with one another, what social networks look like, what environmental factors affect people’s well-being, and analyzing how these and other factors affect social outcomes over time. The first class of formal and computational social models we introduce study how adaptations diffuse through populations using different assumptions about how people learn and what their social networks look like. We will start with formal models that can give us “exact” results by making strong assumptions about population size and social network structure, then show why <em>stochastic</em> computational models are essential to capture the randomness of social interactions and understand how social outcomes may vary depending on the course of chance events.</p>
</section>
</section>
<section id="diffusion-of-adaptations" class="level1">
<h1>Diffusion of adaptations</h1>
<p>Adaptations <em>diffuse</em> through communication or observation from person to person when two things happen. First, a person not doing some adaptive behavior (driving an electric vehicle, using heat pumps in their home for heating and cooling, switching to no-till farming methods, etc.) encounters someone who knows or does an adaptive behavior. Second, the person not doing the adaptive behavior must successfully acquire the knowledge and desire necessary to start doing the behavior themselves. In this section we introduce four models of this process.</p>
<p>The first two assume that an adaptive behavior is randomly adopted by someone performing a legacy behavior with probability <span class="math inline">\(\alpha\)</span>, the adoption rate. One of these assumes that anyone doing the adaptive behavior will continue doing it forever, the <em>Legacy-Adaptive</em> model (Figure <a href="#fig-LA-state" class="quarto-xref">Figure&nbsp;4</a>). The next adds one more assumption, that people can stop doing a behavior, i.e., they can randomly _drop_the behavior, which happens for anyone doing <span class="math inline">\(A\)</span> with probability <span class="math inline">\(\delta\)</span> (Figure <a href="#fig-LAL-state" class="quarto-xref">Figure&nbsp;5</a>).</p>
<p>The second two assume that learning is partly probabilistic and partly <em>adaptive</em>, where individuals can do some computation about who or what behavior may be best to learn. These are <em>social learning</em> models of transmission. The first of these is a <em>conformist-biased learning</em> model, where individuals are assumed to be more likely to learn a behavior if more people are doing it. The second is a <em>success-biased learning</em> model, where individuals are more likely to learn from individuals if an individual is doing relatively well compared to other neighbors. Success-biased learning is the only one of these where the benefit of doing a behavior matters, since there must be a way to acquire “payoffs”, which is a modeling term of art representing amount of benefit, usually in unspecified units.</p>
<section id="la-and-lal-compartmental-contagion-models" class="level2">
<h2 class="anchored" data-anchor-id="la-and-lal-compartmental-contagion-models">LA and LAL compartmental “contagion” models</h2>
<p>Contagion models like the LA and LAL models assume that when individuals encounter one another there is some probability that some individual-level attribute, in this case whether the individual <span class="math inline">\(i\)</span> does <span class="math inline">\(A\)</span>. These models require relatively few parameters and variables, but ignore adaptive strategies people use for acquiring new information (<a href="#tbl-LA-LAL-parameters" class="quarto-xref">Table&nbsp;1</a>).</p>
<p>Namely, these model contain two dynamic <em>outcome variables</em> <span class="math inline">\(L_t\)</span> and <span class="math inline">\(A_t\)</span> if time is discrete (<span class="math inline">\(L(T)\)</span> and <span class="math inline">\(A(t)\)</span> if time is continuous; see Note <span class="citation" data-cites="note-continuous-time-LA-LAL">(<a href="#ref-note-continuous-time-LA-LAL" role="doc-biblioref"><strong>note-continuous-time-LA-LAL?</strong></a>)</span>) the number of individuals performing <span class="math inline">\(L\)</span> and the number performing <span class="math inline">\(A\)</span>. These outcomes are dynamic, so <span class="math inline">\(t\)</span> represents time, which is discrete in our main treatment of these models, meaning that points in time can be indexed by integers, i.e., time steps are indexed by <span class="math inline">\(t_i\)</span> where <span class="math inline">\(i \in \{1, 2, 3,\ldots\}\)</span>, e.g., <span class="math inline">\(t \in \{0, 3, 6, 9, 12, 15, \ldots\}\)</span> could be discrete time steps for a model with <span class="math inline">\(t\)</span> in months meant to represent some process for which we have data every three months. If time is continuous (<span class="citation" data-cites="note-continuous-time-LA-LAL">(<a href="#ref-note-continuous-time-LA-LAL" role="doc-biblioref"><strong>note-continuous-time-LA-LAL?</strong></a>)</span>) then <span class="math inline">\(t\in[0,\infty)\)</span>. Although time can continue on to infinity, we usually specify that models will stop at some time step or when some condition is met. One of the most important conditions is whether the population has <em>fixated</em>, meaning all agents do the same behavior. Finally, there are two parameters that determine the probability that individuals change their behavioral state (from doing <span class="math inline">\(L\)</span> to doing <span class="math inline">\(A\)</span> or vice-versa). In both the LA and LAL models, the probability <span class="math inline">\(A\)</span> is adopted when an <span class="math inline">\(L\)</span> meets an <span class="math inline">\(A\)</span> is the adoption rate, <span class="math inline">\(\alpha\)</span>. In the LAL model, at every time step, every agent doing <span class="math inline">\(A\)</span> might drop the behavior, i.e., stop doing the behavior, reverting to do <span class="math inline">\(L\)</span> for the next time step. The probability one doing <span class="math inline">\(A\)</span> reverts to <span class="math inline">\(L\)</span> is <span class="math inline">\(\delta\)</span>, the <em>drop rate</em>. So, the LA and LAL models are in fact the same model where we can set <span class="math inline">\(\delta = 0\)</span> to recover the LA model from the LAL model.</p>
<div id="tbl-LA-LAL-parameters" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-LA-LAL-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: LA and LAL model parameter and variable symbols and definitions.
</figcaption>
<div aria-describedby="tbl-LA-LAL-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 24%">
<col style="width: 50%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Symbol</th>
<th>Description</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(L,L_t,L(t)\)</span></td>
<td>Number of individuals doing <strong>L</strong>egacy behavior at time <span class="math inline">\(t\)</span>; like <span class="math inline">\(A\)</span> serves as a noun for the behavior itself.</td>
<td><span class="math inline">\(L_t \in \{0,\ldots,N\}\)</span>; <span class="math inline">\(L(t) \in [0, \infty)\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(A,A_t,A(t)\)</span></td>
<td>Number of individuals doing <strong>A</strong>daptive behavior at time <span class="math inline">\(t\)</span>, but used interchangeably for the behavior itself, e.g., “an individual doing <span class="math inline">\(A\)</span>”.</td>
<td><span class="math inline">\(A_t \in \{0,\ldots,N\}\)</span>, <span class="math inline">\(A(t) \in [0, \infty)\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(t\)</span></td>
<td>Time, which could be discrete or continuous. We write <span class="math inline">\(A\)</span> and <span class="math inline">\(L\)</span> as a function of time, i.e., <span class="math inline">\(A_t\)</span> if <span class="math inline">\(t\)</span> is discrete or <span class="math inline">\(A(t)\)</span> if continuous</td>
<td><span class="math inline">\(\{0,1,\ldots\}\)</span> or <span class="math inline">\([0,\infty)\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\alpha\)</span></td>
<td>Adoption rate, i.e., the probability that an individual doing <span class="math inline">\(L\)</span> adopts <span class="math inline">\(A\)</span> if their interaction partner is doing <span class="math inline">\(A\)</span>.</td>
<td><span class="math inline">\([0, 1]\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\delta\)</span></td>
<td>Drop rate, i.e., the probability that an individual doing <span class="math inline">\(A\)</span> stops doing <span class="math inline">\(A\)</span> at time <span class="math inline">\(t\)</span></td>
<td><span class="math inline">\([0, 1]\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(T\)</span></td>
<td><em>Fixation</em> or <em>stopping</em> time. If the modeler specifies the model should stop when all individuals perform the same behavior, it is the fixation time. If the modeler specifies a certain number of steps for the model or there is some condition that causes the model to stop before fixation, it is the stopping time.</td>
<td><span class="math inline">\(\{0,1,\ldots\}\)</span> or <span class="math inline">\([0,\infty)\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="legacy-adaptive-la-model" class="level3">
<h3 class="anchored" data-anchor-id="legacy-adaptive-la-model">Legacy-Adaptive (LA) model</h3>
<div id="fig-LA-state" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-LA-state-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/LA.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="441">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-LA-state-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: The Legacy-Adaptive model only allows for a change of individual-level state from performing the legacy behavior to performing the adaptive behavior.
</figcaption>
</figure>
</div>
</section>
<section id="legacy-adaptive-legacy-lal-model" class="level3">
<h3 class="anchored" data-anchor-id="legacy-adaptive-legacy-lal-model">Legacy-Adaptive-Legacy (LAL) model</h3>
<div id="fig-LAL-state" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-LAL-state-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/LAL.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="441">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-LAL-state-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: The Legacy-Adaptive-Legacy model also allows for transitions from the state <span class="math inline">\(A\)</span> to state <span class="math inline">\(L\)</span>, which occurs with probability <span class="math inline">\(\delta\)</span>.
</figcaption>
</figure>
</div>
<p>When considering the total change in <span class="math inline">\(A,\)</span> written <span class="math inline">\(\Delta A,\)</span> following a discrete time step, <span class="math inline">\(\Delta t\)</span>, from time “now” to time “next” ($t t+1$), we can drop the indices since all indices are <span class="math inline">\(t\)</span>, i.e.,</p>
<p><span class="math display">\[
\Delta A = \alpha A (1 - \frac{A}{N}) - \delta A.
\]</span></p>
<p>We can</p>
<div class="callout callout-style-default callout-note callout-titled" title="Solving LA system of coupled differential equations" label="note-continuous-time-LA-LAL">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solving LA system of coupled differential equations
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>We can additionally represent the LA and LAL models as coupled ordinary differential equations (ODEs). The ODEs appear somewhat like the difference equations, but ODEs can be solved formally or numerically using the tools of calculus.</p>
<section id="la-odes" class="level3">
<h3 class="anchored" data-anchor-id="la-odes">LA ODEs</h3>
<p><span class="math display">\[
\frac{dL}{dt} = -\alpha L A
\]</span></p>
<p><span class="math display">\[
\frac{dA}{dt} = \alpha L A
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(A(t) = \frac{N}{1 + K e^{-\alpha N t}}\)</span></li>
<li><span class="math inline">\(L(t) = N - A(t)\)</span></li>
</ul>
</section>
<section id="si-model-with-substitutions" class="level3">
<h3 class="anchored" data-anchor-id="si-model-with-substitutions">SI Model with Substitutions</h3>
<p>The equations for the SI model become:</p>
<p><span class="math display">\[
\frac{dL}{dt} = -\alpha L A
\]</span></p>
<p><span class="math display">\[
\frac{dA}{dt} = \alpha L A
\]</span></p>
<p>where:</p>
<p><span class="math inline">\(xy\)</span></p>
<p>-<span class="math inline">\(L\)</span>: the number of susceptible individuals -<span class="math inline">\(A\)</span>: the number of infected individuals, -<span class="math inline">\(\alpha\)</span>: the transmission rate, -<span class="math inline">\(N = L + A\)</span>: the total population size (assumed constant).</p>
</section>
<section id="step-by-step-process-to-eliminatel" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-process-to-eliminatel">Step-by-Step Process to Eliminate<span class="math inline">\(L\)</span></h3>
<ol type="1">
<li><p><strong>Express</strong> <span class="math inline">\(L\)</span> in terms of <span class="math inline">\(N\)</span> and <span class="math inline">\(A\)</span>: Since <span class="math inline">\(N = L + A\)</span>, we can write: <span class="math display">\[
L = N - A.
  \]</span></p></li>
<li><p><strong>Substitute</strong> <span class="math inline">\(L = N - A\)</span> into the equation for <span class="math inline">\(\frac{dA}{dt}\)</span>: Replace <span class="math inline">\(L\)</span> in <span class="math inline">\(\frac{dA}{dt} = \alpha L A\)</span>: <span class="math display">\[
\frac{dA}{dt} = \alpha (N - A) A.
  \]</span></p></li>
<li><p><strong>Simplify the resulting equation:</strong> Expand the terms: <span class="math display">\[
\frac{dA}{dt} = \alpha N A - \alpha A^2.
  \]</span></p>
<p>This is now a single nonlinear differential equation for <span class="math inline">\(A\)</span>, where <span class="math inline">\(L\)</span> has been eliminated.</p></li>
</ol>
</section>
<section id="solving-the-equation" class="level3">
<h3 class="anchored" data-anchor-id="solving-the-equation">Solving the Equation</h3>
<p>The resulting equation: <span class="math display">\[
\frac{dA}{dt} = \alpha N A - \alpha A^2
\]</span> is separable. Rearrange terms to separate <span class="math inline">\(A\)</span> and <span class="math inline">\(t\)</span>: <span class="math display">\[
\frac{1}{A (N - A)} \, dA = \alpha \, dt.
\]</span></p>
<p>Perform partial fraction decomposition on <span class="math inline">\(\frac{1}{A (N - A)}\)</span>: <span class="math display">\[
\frac{1}{A (N - A)} = \frac{1}{N} \left( \frac{1}{A} + \frac{1}{N - A} \right).
\]</span></p>
<p>Integrate both sides: <span class="math display">\[
\int \frac{1}{N} \left( \frac{1}{A} + \frac{1}{N - A} \right) dA = \int \alpha \, dt.
\]</span></p>
<p>This yields: <span class="math display">\[
\frac{1}{N} \left( \ln|A| - \ln|N - A| \right) = \alpha t + C,
\]</span> where<span class="math inline">\(C\)</span>is the integration constant.</p>
<p>Simplify: <span class="math display">\[
\ln\left(\frac{A}{N - A}\right) = \alpha N t + C',
\]</span> where <span class="math inline">\(C' =  N C\)</span>.</p>
<p>Exponentiate to solve for<span class="math inline">\(A\)</span>: <span class="math display">\[
\frac{A}{N - A} = e^{\alpha N t + C'}.
\]</span></p>
<p>Rearranging gives: <span class="math display">\[
A = \frac{N}{1 + e^{-C' - \alpha N t}}.
\]</span></p>
<p>Finally, rewrite <span class="math inline">\(e^{-C'}\)</span> as a constant <span class="math inline">\(K\)</span>: <span id="eq-logistic"><span class="math display">\[
A = \frac{N}{1 + K e^{-\alpha N t}},
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(K\)</span> depends on the initial conditions.</p>
<p>This is the solution for <span class="math inline">\(A(t)\)</span>, and <span class="math inline">\(L(t)\)</span> can be recovered using <span class="math inline">\(L(t) = N - A(t)\)</span>.</p>
<p>To find <span class="math inline">\(K\)</span> for some initial condition, set <span class="math inline">\(t=0\)</span>, call <span class="math inline">\(A_0 = A(t=0)\)</span>, and solve for <span class="math inline">\(K\)</span>. Note that when <span class="math inline">\(t=0\)</span>, the denominator in Equation <a href="#eq-logistic" class="quarto-xref">Equation&nbsp;1</a> becomes <span class="math inline">\(1 + K\)</span> since <span class="math inline">\(e^0 = 1\)</span>. Then we have</p>
<p><span class="math display">\[
A(0) = \frac{N}{1 + K}
\]</span></p>
<p>which we can multiply by <span class="math inline">\(1 + K\)</span> on both sides and rearrange to get</p>
<p><span class="math display">\[
K = \frac{N}{A_0}.
\]</span></p>
<p>$$</p>
<p>$$</p>
</section>
<section id="lal-ode" class="level3">
<h3 class="anchored" data-anchor-id="lal-ode">LAL ODE</h3>
<p>See Chapter 3 in Britton’s (2003) <em>Essential Mathematical Biology</em> for the solution of the LAL ODE system,</p>
<p><span class="math display">\[
\frac{dL}{dt} = -\alpha L A + \delta
\]</span></p>
</section>
</div>
</div>
</div>
</section>
</section>
<section id="adaptive-social-learning" class="level2">
<h2 class="anchored" data-anchor-id="adaptive-social-learning">Adaptive social learning</h2>
<p>There are many ways people (or other critters with culture) use social or environmental cues to decide who to learn from, known as <em>social learning strategies</em> <span class="citation" data-cites="Kendal2018">Kendal et al. (<a href="#ref-Kendal2018" role="doc-biblioref">2018</a>)</span>. We will consider the effects of two such social learning strategies in this course, <em>conformity-biased learning</em> and <em>success-biased learning</em>. As before we focus on the discrete-time case, but we will also point towards more advanced resources for using continuous-time to formally calculate helpful heuristic values for understanding asymptotic dynamics.</p>
<section id="conformity-biased-learning" class="level3">
<h3 class="anchored" data-anchor-id="conformity-biased-learning">Conformity-biased learning</h3>
</section>
<section id="success-biased-learning" class="level3">
<h3 class="anchored" data-anchor-id="success-biased-learning">Success-biased learning</h3>
</section>
</section>
</section>
<section id="cooperation-and-coordination" class="level1">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Cooperation and coordination</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Jackson2008" class="csl-entry" role="listitem">
Jackson, Matthew O. 2008. <em><span class="nocase">Social and Economic Networks</span></em>. Princeton: Princeton University Press. <a href="https://press.princeton.edu/books/paperback/9780691148205/social-and-economic-networks">https://press.princeton.edu/books/paperback/9780691148205/social-and-economic-networks</a>.
</div>
<div id="ref-Kendal2018" class="csl-entry" role="listitem">
Kendal, Rachel L., Neeltje J. Boogert, Luke Rendell, Kevin N. Laland, Mike Webster, and Patricia L. Jones. 2018. <span>“<span class="nocase">Social Learning Strategies: Bridge-Building between Fields</span>.”</span> <em>Trends in Cognitive Sciences</em> 22 (7): 651–65. <a href="https://doi.org/10.1016/j.tics.2018.04.003">https://doi.org/10.1016/j.tics.2018.04.003</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>